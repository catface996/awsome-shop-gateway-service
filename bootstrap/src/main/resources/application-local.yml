# Local Development Environment Configuration

server:
  port: 8080

# Gateway backend service URLs
gateway:
  services:
    auth: http://localhost:8001
    product: http://localhost:8002
    point: http://localhost:8003
    order: http://localhost:8004
  auth:
    validate-url: http://localhost:8001/api/v1/internal/auth/validate

# Spring Cloud Gateway Routes
spring:
  cloud:
    gateway:
      server:
        webflux:
          routes:
            # ==================== API Docs Routes ====================
            - id: auth-docs
              uri: ${gateway.services.auth}
              predicates:
                - Path=/v3/api-docs/auth
              filters:
                - RewritePath=/v3/api-docs/auth, /v3/api-docs
                - SwaggerServersRewrite
              metadata:
                auth-required: false

            - id: product-docs
              uri: ${gateway.services.product}
              predicates:
                - Path=/v3/api-docs/product
              filters:
                - RewritePath=/v3/api-docs/product, /v3/api-docs
                - SwaggerServersRewrite
              metadata:
                auth-required: false

            - id: point-docs
              uri: ${gateway.services.point}
              predicates:
                - Path=/v3/api-docs/point
              filters:
                - RewritePath=/v3/api-docs/point, /v3/api-docs
                - SwaggerServersRewrite
              metadata:
                auth-required: false

            - id: order-docs
              uri: ${gateway.services.order}
              predicates:
                - Path=/v3/api-docs/order
              filters:
                - RewritePath=/v3/api-docs/order, /v3/api-docs
                - SwaggerServersRewrite
              metadata:
                auth-required: false

            # ==================== Public Routes (no auth) ====================
            - id: auth-public
              uri: ${gateway.services.auth}
              predicates:
                - Path=/api/v1/public/auth/**
              metadata:
                auth-required: false

            - id: product-public
              uri: ${gateway.services.product}
              predicates:
                - Path=/api/v1/public/product/**
              metadata:
                auth-required: false

            - id: point-public
              uri: ${gateway.services.point}
              predicates:
                - Path=/api/v1/public/point/**
              metadata:
                auth-required: false

            - id: order-public
              uri: ${gateway.services.order}
              predicates:
                - Path=/api/v1/public/order/**
              metadata:
                auth-required: false

            # ==================== Protected Routes (auth required) ====================
            - id: auth-protected
              uri: ${gateway.services.auth}
              predicates:
                - Path=/api/v1/auth/**
              metadata:
                auth-required: true

            - id: product-protected
              uri: ${gateway.services.product}
              predicates:
                - Path=/api/v1/product/**
              metadata:
                auth-required: true

            - id: point-protected
              uri: ${gateway.services.point}
              predicates:
                - Path=/api/v1/point/**
              metadata:
                auth-required: true

            - id: order-protected
              uri: ${gateway.services.order}
              predicates:
                - Path=/api/v1/order/**
              metadata:
                auth-required: true

            # ==================== Service-Prefix Routes (Swagger Try-it-out) ====================
            - id: auth-proxy
              uri: ${gateway.services.auth}
              predicates:
                - Path=/auth/**
              filters:
                - StripPrefix=1
              metadata:
                auth-required: false

            - id: product-proxy
              uri: ${gateway.services.product}
              predicates:
                - Path=/product/**
              filters:
                - StripPrefix=1
              metadata:
                auth-required: false

            - id: point-proxy
              uri: ${gateway.services.point}
              predicates:
                - Path=/point/**
              filters:
                - StripPrefix=1
              metadata:
                auth-required: false

            - id: order-proxy
              uri: ${gateway.services.order}
              predicates:
                - Path=/order/**
              filters:
                - StripPrefix=1
              metadata:
                auth-required: false

# SpringDoc - Swagger aggregation for all backend services
springdoc:
  swagger-ui:
    urls:
      - name: auth
        url: /v3/api-docs/auth
      - name: product
        url: /v3/api-docs/product
      - name: point
        url: /v3/api-docs/point
      - name: order
        url: /v3/api-docs/order
